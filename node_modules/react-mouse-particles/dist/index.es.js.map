{"version":3,"file":"index.es.js","sources":["../src/index.js"],"sourcesContent":["import React from \"react\";\nimport Proton from \"proton-engine\";\nimport RAFManager from \"raf-manager\";\n\nclass MouseParticles extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this.ease = 0.7;\n    this.level = 0;\n    this.LEVEL = 5;\n    this._allowEmitting = true;\n    this.renderProton = this.renderProton.bind(this);\n    this.mouseMoveHandler = this.mouseMoveHandler.bind(this);\n    this.mouseDownHandler = this.mouseDownHandler.bind(this);\n    this.mouseUpHandler = this.mouseUpHandler.bind(this);\n\n    this.createContainerDom();\n  }\n\n  createContainerDom() {\n    this.dom = document.createElement(\"div\");\n    this.dom.style.position = \"fixed\";\n    this.dom.style.left = \"0px\";\n    this.dom.style.top = \"0px\";\n    this.dom.style.zIndex = 9999;\n    this.dom.pointerEvents = \"none\";\n    this.dom.id = `rmps_${(Math.random() * 999999) >> 0}`;\n    document.body.appendChild(this.dom);\n  }\n\n  componentWillUnmount() {\n    try {\n      document.body.removeEventListener(\"mousemove\", this.mouseMoveHandler, false);\n      document.body.removeEventListener(\"mousedown\", this.mouseDownHandler, false);\n      document.body.removeEventListener(\"mouseup\", this.mouseUpHandler, false);\n      RAFManager.remove(this.renderProton);\n      this.proton.destroy();\n    } catch (e) {}\n  }\n\n  componentDidMount() {\n    this.onCanvasInited();\n    this.addMouseEventListener();\n    this.setCullList();\n  }\n\n  onCanvasInited() {\n    this.createProton();\n    RAFManager.add(this.renderProton);\n  }\n\n  addMouseEventListener() {\n    document.body.addEventListener(\"mousemove\", this.mouseMoveHandler, false);\n    document.body.addEventListener(\"mousedown\", this.mouseDownHandler, false);\n    document.body.addEventListener(\"mouseup\", this.mouseUpHandler, false);\n  }\n\n  mouseDownHandler(e) {}\n  mouseUpHandler(e) {}\n\n  mouseMoveHandler(e) {\n    if (this.isCullDom(e)) return;\n    let x,\n      y = 0;\n\n    x = e.clientX;\n    y = e.clientY;\n\n    this.emitter.p.x += (x - this.emitter.p.x) * this.ease;\n    this.emitter.p.y += (y - this.emitter.p.y) * this.ease;\n\n    if (this._allowEmitting) this.emitter.emit(\"once\");\n  }\n\n  setCullList() {\n    this.cullClassList = this.props.cull || \"\";\n    this.cullClassList = this.cullClassList.split(\",\");\n\n    this.LEVEL = this.props.level || 6;\n  }\n\n  isCullDom(e) {\n    this.level = 0;\n    \n    if (isInputText(e.target)) return true;\n    if (isTextBox(e.target)) return true;\n    if (!this.cullClassList || !this.cullClassList.length) return false;\n\n    return this.isContain(e.target, this.cullClassList);\n  }\n\n  isContain(element, cullClassList) {\n    if (this.level >= this.LEVEL) return false;\n    if (!element) return false;\n    if (!element.classList) return false;\n    if (element === document.body) return false;\n\n    for (let i = 0; i < cullClassList.length; i++) {\n      if (element.classList.contains(cullClassList[i])) {\n        return true;\n      }\n    }\n    this.level++;\n\n    return this.isContain(element.parentNode, cullClassList);\n  }\n\n  createProton(canvas) {\n    this.proton = new Proton();\n\n    const emitter = new Proton.Emitter();\n    emitter.rate = new Proton.Rate(this.props.num || 3);\n    emitter.damping = 0.008;\n\n    const life = this.props.life ? new Proton.Life(this.props.life) : new Proton.Life(0.2, 0.5);\n    const color = this.props.color || \"random\";\n    const g = this.props.g;\n    const v = this.props.v || 0.65;\n    const alpha = this.props.alpha || Proton.getSpan(0.25, 0.55);\n    const tha = this.props.tha ? new Proton.Span(this.props.tha[0], this.props.tha[1]) : new Proton.Span(0, 360);\n    let radius = new Proton.Radius(2, 5);\n    if (this.props.radius) {\n      const r = this.props.radius;\n      radius = new Proton.Radius(r * 0.8, r);\n    }\n\n    emitter.addInitialize(new Proton.Mass(1));\n    emitter.addInitialize(radius);\n    emitter.addInitialize(life);\n    emitter.addInitialize(new Proton.Velocity(new Proton.Span(v), tha, \"polar\"));\n\n    emitter.addBehaviour(new Proton.Alpha(alpha));\n    emitter.addBehaviour(new Proton.Color(color));\n    emitter.addBehaviour(new Proton.Scale(1, 0.1));\n    emitter.addBehaviour(new Proton.RandomDrift(10, 10, 0.2));\n    if (g) {\n      emitter.addBehaviour(new Proton.G(parseFloat(g)));\n    }\n\n    this.proton.addEmitter(emitter);\n    const renderer = new Proton.DomRenderer(this.dom);\n    this.proton.addRenderer(renderer);\n    this.emitter = emitter;\n  }\n\n  renderProton() {\n    this.proton && this.proton.update();\n  }\n\n  render() {\n    return <React.Fragment />;\n  }\n}\n\n// utils function\nfunction isInputText(element) {\n  return element instanceof HTMLInputElement && element.type === \"text\";\n}\n\nfunction isTextBox(element) {\n  let tagName = element.tagName.toLowerCase();\n  if (tagName === \"textarea\") return true;\n  if (tagName === \"input\") return true;\n\n  return false;\n}\n\nexport default MouseParticles;\n"],"names":["MouseParticles","props","ease","level","LEVEL","_allowEmitting","renderProton","bind","mouseMoveHandler","mouseDownHandler","mouseUpHandler","createContainerDom","dom","document","createElement","style","position","left","top","zIndex","pointerEvents","id","Math","random","body","appendChild","removeEventListener","remove","proton","destroy","e","onCanvasInited","addMouseEventListener","setCullList","createProton","add","addEventListener","isCullDom","x","y","clientX","clientY","emitter","p","emit","cullClassList","cull","split","isInputText","target","isTextBox","length","isContain","element","classList","i","contains","parentNode","canvas","Proton","Emitter","rate","Rate","num","damping","life","Life","color","g","v","alpha","getSpan","tha","Span","radius","Radius","r","addInitialize","Mass","Velocity","addBehaviour","Alpha","Color","Scale","RandomDrift","G","parseFloat","addEmitter","renderer","DomRenderer","addRenderer","update","React","Component","HTMLInputElement","type","tagName","toLowerCase"],"mappings":"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"}